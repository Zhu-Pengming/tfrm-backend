@echo off
REM 运行TFRM集成测试 - 真实服务器 + 真实LLM

echo ================================================================================
echo TFRM 集成测试 - 真实服务器 + 真实LLM
echo ================================================================================
echo.
echo 此测试会:
echo   - 通过HTTP请求调用真实的API接口
echo   - 使用真实的LLM进行AI解析
echo   - 模拟完整的业务流程
echo.
echo 前置条件:
echo   1. 服务器必须已启动 (运行 start_server.bat)
echo   2. Celery worker必须已启动
echo   3. Redis必须已启动
echo.
echo ================================================================================
echo.

REM 检查服务器是否运行
echo [检查] 检查服务器是否运行...
curl -s http://localhost:8000/ >nul 2>&1
if %ERRORLEVEL% NEQ 0 (
    echo.
    echo ================================================================================
    echo 错误: 服务器未运行！
    echo ================================================================================
    echo.
    echo 请先启动服务器:
    echo   1. 打开新的命令行窗口
    echo   2. 运行: start_server.bat
    echo   3. 等待服务器启动完成
    echo   4. 再运行此测试脚本
    echo.
    echo ================================================================================
    pause
    exit /b 1
)

echo   服务器运行正常
echo.

REM 运行集成测试
python test_integration_real_server.py

if %ERRORLEVEL% EQU 0 (
    echo.
    echo ================================================================================
    echo 集成测试通过！
    echo ================================================================================
) else (
    echo.
    echo ================================================================================
    echo 集成测试失败，请查看上面的错误信息
    echo ================================================================================
)

echo.
pause
