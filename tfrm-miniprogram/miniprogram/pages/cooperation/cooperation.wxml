<view class="container">
  <!-- Tab åˆ‡æ¢ -->
  <view class="tabs">
    <view 
      class="tab {{activeTab === 'sent' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="sent"
    >
      <text class="tab-text">æˆ‘å‘èµ·çš„</text>
      <text class="tab-count">({{sentCount}})</text>
    </view>
    <view 
      class="tab {{activeTab === 'received' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="received"
    >
      <text class="tab-text">æ”¶åˆ°çš„ç”³è¯·</text>
      <view class="tab-badge-wrapper">
        <text class="tab-count">({{receivedCount}})</text>
        <text wx:if="{{pendingCount > 0}}" class="badge">{{pendingCount}}</text>
      </view>
    </view>
  </view>

  <!-- åˆä½œåˆ—è¡¨ -->
  <scroll-view scroll-y class="cooperation-list" enable-back-to-top>
    <view 
      wx:for="{{cooperationList}}" 
      wx:key="id" 
      class="cooperation-card"
    >
      <view class="card-header">
        <view class="agency-info">
          <text class="agency-icon">ğŸ¢</text>
          <view class="agency-details">
            <text class="agency-name">
              {{activeTab === 'sent' ? item.to_agency_name : item.from_agency_name}}
            </text>
            <text class="time">{{item.created_at}}</text>
          </view>
        </view>
        <view class="status-badge status-{{item.status}}">
          {{statusMap[item.status]}}
        </view>
      </view>

      <view wx:if="{{item.request_message}}" class="message-block">
        <view class="message-label">
          <text class="label-icon">ğŸ’¬</text>
          <text class="label-text">ç”³è¯·è¯´æ˜</text>
        </view>
        <text class="message-content">{{item.request_message}}</text>
      </view>

      <view wx:if="{{item.response_message}}" class="message-block">
        <view class="message-label">
          <text class="label-icon">ğŸ’­</text>
          <text class="label-text">å›å¤</text>
        </view>
        <text class="message-content">{{item.response_message}}</text>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="actions">
        <!-- å¾…å®¡æ ¸çŠ¶æ€ - æ”¶åˆ°çš„ç”³è¯· -->
        <block wx:if="{{activeTab === 'received' && item.status === 'pending'}}">
          <button 
            class="btn-action btn-approve"
            bindtap="onApprove"
            data-id="{{item.id}}"
          >
            âœ“ é€šè¿‡
          </button>
          <button 
            class="btn-action btn-reject"
            bindtap="onReject"
            data-id="{{item.id}}"
          >
            âœ• æ‹’ç»
          </button>
        </block>

        <!-- å·²é€šè¿‡çŠ¶æ€ - å¯ç»ˆæ­¢ -->
        <block wx:if="{{item.status === 'approved'}}">
          <button 
            class="btn-action btn-terminate"
            bindtap="onTerminate"
            data-id="{{item.id}}"
          >
            ç»ˆæ­¢åˆä½œ
          </button>
        </block>

        <!-- æŸ¥çœ‹è¯¦æƒ… -->
        <button 
          class="btn-action btn-detail"
          bindtap="onViewDetail"
          data-id="{{item.id}}"
        >
          è¯¦æƒ…
        </button>
      </view>
    </view>

    <view wx:if="{{loading}}" class="loading">
      <view class="loading-spinner"></view>
      <text>åŠ è½½ä¸­...</text>
    </view>

    <view wx:if="{{!loading && cooperationList.length === 0}}" class="empty">
      <image class="empty-icon" src="/assets/icons/empty.png" mode="aspectFit" />
      <text class="empty-text">æš‚æ— {{activeTab === 'sent' ? 'å‘èµ·çš„' : 'æ”¶åˆ°çš„'}}åˆä½œç”³è¯·</text>
      <text wx:if="{{activeTab === 'sent'}}" class="empty-hint">å‰å¾€å…¬å…±åº“æµè§ˆèµ„æºå¹¶ç”³è¯·åˆä½œ</text>
    </view>
  </scroll-view>
</view>
